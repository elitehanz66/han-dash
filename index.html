<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center font-mono">

    <div class="w-full max-w-lg p-8 bg-gray-800 rounded-xl border border-blue-500 shadow-2xl">
        
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-blue-400">PUSAT KONTROL</h2>
            <button onclick="cekStatusServer()" class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded transition">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>

        <div class="mb-6 p-4 bg-black/40 rounded-lg border border-gray-600 relative overflow-hidden">
            <div id="badgeStatus" class="absolute top-0 right-0 bg-gray-600 text-[10px] px-2 py-0.5 rounded-bl font-bold">LOADING...</div>
            
            <div class="grid grid-cols-3 gap-4 text-sm">
                <div class="text-gray-400">Versi Server:</div>
                <div class="col-span-2 font-bold text-green-400" id="showVer">...</div>
                
                <div class="text-gray-400">Link Server:</div>
                <div class="col-span-2 text-blue-300 break-all text-xs" id="showLink">...</div>

                <div class="text-gray-400">Status Mode:</div>
                <div class="col-span-2 font-bold" id="showMaint">...</div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <button onclick="setMaintenance(false)" class="bg-green-600 hover:bg-green-700 py-3 rounded text-sm font-bold shadow-lg shadow-green-500/20 transition">
                <i class="fas fa-play"></i> ONLINE MODE
            </button>
            <button onclick="setMaintenance(true)" class="bg-red-600 hover:bg-red-700 py-3 rounded text-sm font-bold shadow-lg shadow-red-500/20 transition">
                <i class="fas fa-ban"></i> MAINTENANCE
            </button>
        </div>
        <div class="space-y-4 border-t border-gray-700 pt-6">
            <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Update File / Versi</h3>
            
            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">VERSI BARU</label>
                <input type="text" id="verInput" class="w-full bg-gray-900 border border-gray-600 rounded p-3 focus:border-blue-500 outline-none transition" placeholder="Contoh: 1.5">
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">LINK BARU (Raw/Direct)</label>
                <input type="text" id="linkInput" class="w-full bg-gray-900 border border-gray-600 rounded p-3 focus:border-blue-500 outline-none transition" placeholder="https://github.com/...">
            </div>

            <button onclick="kirimUpdate()" id="btnKirim" class="w-full bg-blue-600 hover:bg-blue-700 font-bold py-3 rounded transition shadow-lg shadow-blue-500/30">
                UPDATE SISTEM
            </button>

            <p id="status" class="mt-4 text-xs text-center text-gray-400">System Ready.</p>
        </div>
    </div>

    <script>
        // === KONFIGURASI ===
        const CONFIG = {
            binId: '697f7a76d0ea881f4098f16b',
            apiKey: '$2a$10$HH4YVR69nzQ8gD4/NngQt.s82mY/6EUPLNO5Kl7AsrBNQkQ/mjKd2' 
        };
        // ===================

        // Variabel global untuk menyimpan data terakhir
        let currentData = { version: "1.0", download_url: "", maintenance: false };

        // Fungsi 1: Ambil Data (GET)
        async function cekStatusServer() {
            const verDisplay = document.getElementById('showVer');
            const linkDisplay = document.getElementById('showLink');
            const maintDisplay = document.getElementById('showMaint');
            const badge = document.getElementById('badgeStatus');

            verDisplay.innerText = "...";
            
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: { 'X-Master-Key': CONFIG.apiKey, 'X-Bin-Meta': 'false' }
                });

                if (res.ok) {
                    const data = await res.json();
                    currentData = data; // Simpan ke variabel global

                    // Tampilkan Data
                    const version = data.version || "1.0";
                    const url = data.download_url || data.url || "-";
                    const isMaint = data.maintenance === true;

                    verDisplay.innerText = "v" + version;
                    linkDisplay.innerText = url;
                    
                    if(isMaint) {
                        maintDisplay.innerText = "SEDANG MAINTENANCE (TUTUP)";
                        maintDisplay.className = "col-span-2 font-bold text-red-500";
                        badge.innerText = "OFFLINE";
                        badge.className = "absolute top-0 right-0 bg-red-600 text-[10px] px-2 py-0.5 rounded-bl font-bold";
                    } else {
                        maintDisplay.innerText = "NORMAL (ONLINE)";
                        maintDisplay.className = "col-span-2 font-bold text-green-500";
                        badge.innerText = "ONLINE";
                        badge.className = "absolute top-0 right-0 bg-green-600 text-[10px] px-2 py-0.5 rounded-bl font-bold";
                    }

                    // Isi otomatis input form biar gampang edit
                    document.getElementById('verInput').value = version;
                    document.getElementById('linkInput').value = url;

                } else {
                    verDisplay.innerText = "Gagal memuat";
                }
            } catch (e) {
                verDisplay.innerText = "Error Koneksi";
            }
        }

        // Fungsi 2: Ganti Mode Maintenance (Tanpa ubah versi/link)
        async function setMaintenance(status) {
            const stat = document.getElementById('status');
            stat.innerText = status ? "Mengaktifkan Maintenance..." : "Mengaktifkan Online Mode...";
            
            // Kita pakai data terakhir (currentData) tapi ubah status maintenance-nya
            const paketData = { 
                version: currentData.version, 
                download_url: currentData.download_url || currentData.url,
                maintenance: status // True atau False
            };

            await pushKeServer(paketData);
        }

        // Fungsi 3: Kirim Update Versi (Sekaligus matikan maintenance biasanya)
        async function kirimUpdate() {
            const ver = document.getElementById('verInput').value;
            const url = document.getElementById('linkInput').value;
            
            if(!ver || !url) return alert("Isi versi dan link dulu!");

            const paketData = { 
                version: ver, 
                download_url: url,
                maintenance: false // Kalau update, biasanya kita mau langsung Online
            };

            await pushKeServer(paketData);
        }

        // Fungsi Inti: Kirim ke JsonBin
        async function pushKeServer(payload) {
            const stat = document.getElementById('status');
            
            try {
                const respon = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CONFIG.apiKey
                    },
                    body: JSON.stringify(payload)
                });

                if(respon.ok) {
                    stat.innerText = "SUKSES! Status Server Diperbarui.";
                    stat.className = "mt-4 text-xs text-center text-green-400";
                    cekStatusServer(); // Refresh tampilan
                } else {
                    throw new Error("Gagal Auth.");
                }
            } catch(e) {
                stat.innerText = "ERROR: " + e.message;
                stat.className = "mt-4 text-xs text-center text-red-500";
            }
        }

        window.onload = cekStatusServer;
    </script>
</body>
</html>
